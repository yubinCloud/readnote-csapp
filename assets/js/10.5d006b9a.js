(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{813:function(t,s,a){t.exports=a.p+"assets/img/2021-09-09-13-10-40.e0da36f9.png"},814:function(t,s,a){t.exports=a.p+"assets/img/2021-09-09-13-16-01.dda5450e.png"},815:function(t,s,a){t.exports=a.p+"assets/img/2021-09-09-13-32-56.984a8cf3.png"},816:function(t,s,a){t.exports=a.p+"assets/img/2021-09-11-22-25-52.20f47d09.png"},817:function(t,s,a){t.exports=a.p+"assets/img/2021-09-11-22-31-34.6e097a5c.png"},818:function(t,s,a){t.exports=a.p+"assets/img/2021-09-11-22-38-09.bb870162.png"},819:function(t,s,a){t.exports=a.p+"assets/img/2021-09-11-22-58-42.ce31ab1d.png"},820:function(t,s,a){t.exports=a.p+"assets/img/2021-09-11-22-58-53.e4068f9a.png"},852:function(t,s,a){"use strict";a.r(s);var n=a(68),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"二、目标文件格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、目标文件格式"}},[t._v("#")]),t._v(" 二、目标文件格式")]),t._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#二、目标文件格式"}},[t._v("二、目标文件格式")]),n("ul",[n("li",[n("a",{attrs:{href:"#_2-1-三类目标文件"}},[t._v("2.1 三类目标文件")])]),n("li",[n("a",{attrs:{href:"#_2-2-目标文件的格式"}},[t._v("2.2 目标文件的格式")])]),n("li",[n("a",{attrs:{href:"#_2-3-elf-目标文件格式"}},[t._v("2.3 ELF 目标文件格式")])]),n("li",[n("a",{attrs:{href:"#_2-4-可重定位目标文件格式"}},[t._v("2.4 可重定位目标文件格式")])]),n("li",[n("a",{attrs:{href:"#_2-5-可执行目标文件格式"}},[t._v("2.5 可执行目标文件格式")])])])])])]),n("p"),t._v(" "),n("h2",{attrs:{id:"_2-1-三类目标文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-三类目标文件"}},[t._v("#")]),t._v(" 2.1 三类目标文件")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("可重定位目标文件")]),t._v("（.o）\n"),n("ul",[n("li",[t._v("其代码和数据可和其他可重定位文件合并为可执行文件；")]),t._v(" "),n("li",[t._v("每个 .o 文件由对应的 .c 文件生成；")]),t._v(" "),n("li",[t._v("每个 .o 文件代码和数据"),n("u",[t._v("地址都是从 0 开始")]),t._v("。")])])]),t._v(" "),n("li",[n("strong",[t._v("可执行目标文件")]),t._v("（default：a.out）\n"),n("ul",[n("li",[t._v("包含的代码和数据可以被直接复制到内存并被执行；")]),t._v(" "),n("li",[t._v("代码和数据"),n("u",[t._v("地址为虚拟地址")]),t._v("空间中的地址")])])]),t._v(" "),n("li",[n("strong",[t._v("共享的目标文件")]),t._v("（.so）\n"),n("ul",[n("li",[t._v("特殊的可重定位目标文件，能在装入或运行时被装入到内存并自动被链接，称为"),n("strong",[t._v("共享库文件")])]),t._v(" "),n("li",[t._v("Windows 中称其为 Dynamic Link Libraries (DLLs)")])])])]),t._v(" "),n("h2",{attrs:{id:"_2-2-目标文件的格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-目标文件的格式"}},[t._v("#")]),t._v(" 2.2 目标文件的格式")]),t._v(" "),n("p",[n("strong",[t._v("目标代码")]),t._v("（Object Code）指编译器和汇编器处理源代码后所生成的机器语言目标代码。")]),t._v(" "),n("p",[n("strong",[t._v("目标文件")]),t._v("（Object File）指包含目标代码的文件。")]),t._v(" "),n("p",[t._v("目标文件的标准二进制格式：")]),t._v(" "),n("ul",[n("li",[t._v("DOS 操作系统：COM 格式")]),t._v(" "),n("li",[t._v("System V UNIX 早期版本：COFF 格式")]),t._v(" "),n("li",[t._v("Windows：PE 格式")]),t._v(" "),n("li",[t._v("Linux 等类 UNIX：ELF 格式")])]),t._v(" "),n("h2",{attrs:{id:"_2-3-elf-目标文件格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-elf-目标文件格式"}},[t._v("#")]),t._v(" 2.3 ELF 目标文件格式")]),t._v(" "),n("p",[t._v("目标文件既可用于程序的链接，也可用于程序的执行。")]),t._v(" "),n("p",[t._v("有两种视图：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("链接视图")]),t._v("，被链接，可重定位目标文件；\n"),n("ul",[n("li",[t._v("主要由不同的"),n("em",[t._v("节")]),t._v("组成，不同的节描述了目标文件中不同类型的信息及特征。")])])]),t._v(" "),n("li",[n("strong",[t._v("执行视图")]),t._v("，被执行，可执行目标文件。\n"),n("ul",[n("li",[t._v("主要由不同的"),n("em",[t._v("段")]),t._v("组成，描述了目标文件中的节如何映射到存储空间的段。")])])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(813),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"_2-4-可重定位目标文件格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-可重定位目标文件格式"}},[t._v("#")]),t._v(" 2.4 可重定位目标文件格式")]),t._v(" "),n("blockquote",[n("p",[t._v("可重定位目标文件主要包含代码部分和数据部分，它可以与其他可重定位目标文件链接，从而创建可执行目标文件、共享库文件。")])]),t._v(" "),n("ul",[n("li",[t._v("可被链接（合并）生成可执行文件或共享目标文件；")]),t._v(" "),n("li",[t._v("静态链接库文件由若干个可重定位目标文件组成；")]),t._v(" "),n("li",[t._v("包含代码、数据（已初始化全局变量和局部静态变量.data和未初始化的全局变量和局部静态变量.bss）；")]),t._v(" "),n("li",[t._v("包含重定位信息（指出哪些符号引用处需要重定位）；")]),t._v(" "),n("li",[t._v("文件扩展名为.o（相当于Windows中的 .obj文件）")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(814),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"_1-elf-头"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-elf-头"}},[t._v("#")]),t._v(" （1）ELF 头")]),t._v(" "),n("p",[n("strong",[t._v("ELF 头")]),t._v("位于目标文件的起始位置，包含文件结构说明信息。分32位版本和64位版本。")]),t._v(" "),n("p",[t._v("32位系统对应的数据结构，共占 52（0x34） 字节：")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("EI_NIDENT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")])])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" e_ident"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("EI_NIDENT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开始的四个字节是魔数，后面的16个字节包含一些标识信息，如字节序、32/64位、版本号等")]),t._v("\n   Elf32_Half e_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目标文件类型（可重定位文件、可执行文件、共享库文件还是其他类型文件）")]),t._v("\n   Elf32_Half e_machine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 机器结构类型（如 IA-32、AMD 64等）")]),t._v("\n   Elf32_Word e_version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目标文件版本")]),t._v("\n   Elf32_Addr e_entry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定系统将控制权转移到的起始虚拟地址（程序入口点），如果没有关联入口点则为0，比如可重定位文件就是0")]),t._v("\n   Elf32_Off e_phoff"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   Elf32_Off e_shoff"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节头表在文件中的偏移量（以字节为单位）")]),t._v("\n   Elf32_Word e_flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   Elf32_Half e_ehsize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ELF 头的大小（以字节为单位）")]),t._v("\n   Elf32_Half e_phentsize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n   Elf32_Half e_phnum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   Elf32_Half e_shentsize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节头表中一个表项的大小，所有表项大小相同")]),t._v("\n   Elf32_Half e_shnum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节头表项的个数")]),t._v("\n   Elf32_Half e_shstrndx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Ehdr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br")])]),n("ul",[n("li",[n("strong",[t._v("魔数")]),t._v("：文件开头几个字节通常用来确定文件的类型或格式。\n"),n("ul",[n("li",[t._v("a.out的魔数：01H 07H")]),t._v(" "),n("li",[t._v("PE格式魔数：4DH 5AH")]),t._v(" "),n("li",[n("u",[t._v("加载或读取文件时，可用魔数确认文件类型是否正确")])])])]),t._v(" "),n("li",[t._v("仅 ELF 头在文件中具有固定位置，即总是在开头位置，其余部分的位置由 ELF 头和节头表指出。")])]),t._v(" "),n("p",[t._v("可以用 "),n("code",[t._v("readelf -h")]),t._v(" 命令对某个可重定位目标文件的 ELF 头进行解析。")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("ELF头信息举例")]),t._v(" "),n("p",[n("img",{attrs:{src:a(815),alt:""}})]),t._v(" "),n("ul",[n("li",[t._v("因为是可重定位文件，所以字段 "),n("code",[t._v("e_entry")]),t._v(" 为0，无程序头表（Size of program headers = 0）。")])])]),t._v(" "),n("h3",{attrs:{id:"_2-节"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-节"}},[t._v("#")]),t._v(" （2）节")]),t._v(" "),n("p",[n("strong",[t._v("节")]),t._v("是 ELF 文件中的主体信息，包含了链接过程所用的目标代码信息，包括指令、数据、符号表和重定位信息等。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("节名")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".text")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("已编译程序的机器代码")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".rodata")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("只读数据，如 printf 语句中的格式串、开关语句（switch-case）的跳转表等")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".data")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("已初始化的全局变量")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".bss")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("未初始化的全局和静态变量，以及所有被初始化为 0 的全局或静态变量。"),n("strong",[t._v("在目标文件中这个节不占据实际的空间")]),t._v("，它仅仅是一个占位符，为了节省空间。在运行时，在内存中将这些变量初始化为 0。")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".symtab")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("符号表（symbol table）,程序中定义的函数名和全局静态变量名都属于"),n("strong",[t._v("符号")]),t._v("，与这些符号相关的信息保存在符号表中。每个可重定位目标文件都有一个 .symtab 节。和编译器中的符号表不同， .symtab 符号表不包含局部变量的条目。")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".rel.text")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v(".text 节相关的重定位信息。当链接器合并目标文件时，.text 中的代码合并后部分位置的数据需要修改。一般而言，任何调用外部函数或者引用全局变量的指令都需要修改定位信息。另一方面，调用本地函数的指令则不需要修改。 TIP：可执行文件中并不需要重定位信息。")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".rel.data")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v(".data 节相关的可重定位信息。一般而言，任何已初始化的全局变量，如果它的初始值是一个全局变量地址或者外部定义函数的地址，都需要被修改。")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".debug")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("调试用符号表。其条目是程序中定义的全局变量和类型定义，程序中定义和引用的全局变量，以及原始的 C 源文件。")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".line")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("C 源程序中的行号和 .text 节中机器指令之间的映射。")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v(".strtab")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("字符串表。包括 .symtab 节和 .debug 节中的符号以及节头表中的节名。字符串表就是以 null 结尾的字符序列。")])])])]),t._v(" "),n("ul",[n("li",[t._v('.bss 可以记成 "Better Save Space"。')]),t._v(" "),n("li",[t._v("只有使用 -g 选项的 gcc 命令才能得到 .debug 和 .line 表。")])]),t._v(" "),n("h3",{attrs:{id:"_3-节头表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-节头表"}},[t._v("#")]),t._v(" （3）节头表")]),t._v(" "),n("p",[t._v("节头表（Section Header Table）由若干表项组成，"),n("u",[t._v("每个表项描述相应的一个节的节名、在文件中的偏移、大小、访问属性、对齐方式等")]),t._v("，目标文件中的每个节都有一个表项与之对应。")]),t._v(" "),n("ul",[n("li",[t._v("除ELF头之外，节头表是ELF可重定位目标文件中最重要的部分内容。")])]),t._v(" "),n("p",[t._v("以下是 32 位系统对应的数据结构（每个表项占40B）：")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   Elf32_Word sh_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节名字符串在.strtab中的偏移")]),t._v("\n   Elf32_Word sh_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节类型：无效/代码或数据/符号/字符串/…")]),t._v("\n   Elf32_Word sh_flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节标志：该节在虚拟空间中的访问属性")]),t._v("\n   Elf32_Addr sh_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 虚拟地址：若可被加载，则对应虚拟地址")]),t._v("\n   Elf32_Off sh_offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在文件中的偏移地址，对.bss节而言则无意义")]),t._v("\n   Elf32_Word sh_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节在文件中所占的长度")]),t._v("\n   Elf32_Word sh_link"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sh_link和sh_info用于与链接相关的节（如.rel.text节、.rel.data节、.symtab节等）")]),t._v("\n   Elf32_Word sh_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   Elf32_Word sh_addralign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节的对齐要求")]),t._v("\n   Elf32_Word sh_entsize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节中每个表项的长度，0表示无固定长度表项")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Shdr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("节头表信息举例")]),t._v(" "),n("p",[n("img",{attrs:{src:a(816),alt:""}})]),t._v(" "),n("ul",[n("li",[t._v("从上述解析结果可以看出，该 test.o 共 11 个节。节头表从 120 字节开始。")]),t._v(" "),n("li",[t._v("其中，.text、.data、"),n("u",[t._v(".bss")]),t._v(" 和 .rodata 节需要在存储器中分配空间。.text 是可执行的，.data 和 .bss 是可读写的，.rodata 是只读的。\n"),n("ul",[n("li",[t._v("由于在真正运行时也要对 .bss 节中的数据进行读写，所以它也要占空间。")])])]),t._v(" "),n("li",[t._v("根据每个节在文件中的偏移地址和长度，可以画出 test.o 的结构：")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(817),alt:""}})]),t._v(" "),n("ul",[n("li",[t._v("比较特殊的一个地方：.bss 在文件中不占用空间，但节头表记录了 .bss 节的长度为 0x0c = 12，因此需要在主存中给 .bss 节分配 12 字节空间。")])])]),t._v(" "),n("p",[t._v("整体就是通过 ELF 头连接了节头表，再通过节头表把每一个节连接起来了。")]),t._v(" "),n("h2",{attrs:{id:"_2-5-可执行目标文件格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-可执行目标文件格式"}},[t._v("#")]),t._v(" 2.5 可执行目标文件格式")]),t._v(" "),n("p",[n("img",{attrs:{src:a(818),alt:""}})]),t._v(" "),n("p",[t._v("与可重定文件稍有不同：")]),t._v(" "),n("ul",[n("li",[t._v("ELF头中字段 e_entry 给出执行程序时第一条指令的地址，而在可重定位文件中，此字段为0；")]),t._v(" "),n("li",[t._v("多一个"),n("strong",[t._v("程序头表")]),t._v("，也称段头表（segment header table），是一个结构数组，用来说明段信息；")]),t._v(" "),n("li",[t._v("多一个.init节，用于定义_init函数，该函数用来进行可执行目标文件开始执行时的初始化工作；")]),t._v(" "),n("li",[t._v("少两个.rel节（无需重定位）。")])]),t._v(" "),n("p",[t._v("在可执行文件中，ELF 头、程序头表、.init 节、.fini 节、.text 节和 .rodata 节合起来可构成一个"),n("strong",[t._v("只读代码段")]),t._v("；.data 节和 .bss 节合起来可构成一个"),n("strong",[t._v("可读写数据段")]),t._v("。显然，在可执行文件启动执行时，这两个段必须装入内存，因而称为"),n("strong",[t._v("可装入段")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"程序头表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#程序头表"}},[t._v("#")]),t._v(" 程序头表")]),t._v(" "),n("p",[t._v("为了可执行文件执行时能够给在内存中访问到代码和数据，必须将可执行文件中这些"),n("strong",[t._v("连续的")]),t._v("、"),n("strong",[t._v("具有相同访问属性的")]),t._v("代码和数据段映射到存储空间（通常是虚拟地址空间）。"),n("u",[t._v("程序头表就用于描述这种映射关系")]),t._v("，一个表项对应一个连续的存储段或特殊节。程序头表表项大小分别由 ELF 头中的字段 e_phentsize 和 e_phnum 指定。")]),t._v(" "),n("p",[t._v("32 为系统的程序头表中每个表项具有如下数据结构：")]),t._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   Elf32_Word p_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 描述存储段的类型或特殊节的类型")]),t._v("\n   Elf32_Off p_offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指出本段的首字节在文件中的偏移地址")]),t._v("\n   Elf32_Addr p_vaddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指出本段首字节的虚拟地址")]),t._v("\n   Elf32_Addr p_paddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指出本段首字节的物理地址，该信息通常无效")]),t._v("\n   Elf32_Word p_filesz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指出本段在文件中所占的字节数，可以为 0")]),t._v("\n   Elf32_Word p_memsz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 本段在存储器中所占的字节数，也可为 0")]),t._v("\n   Elf32_Word p_flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 存取权限")]),t._v("\n   Elf32_Word p_align"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对齐方式，用一个模数表示，为 2 的正整数幂")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Phdr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("程序头表示例")]),t._v(" "),n("p",[t._v("使用 "),n("code",[t._v("readelf -l main")]),t._v(" 命令显示的可执行文件 main 的程序头表信息：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(819),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(820),alt:""}})])])])}),[],!1,null,null,null);s.default=e.exports}}]);