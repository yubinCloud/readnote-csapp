(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{829:function(s,t,a){s.exports=a.p+"assets/img/2021-09-03-23-03-04.8a9bfd06.png"},830:function(s,t,a){s.exports=a.p+"assets/img/2021-09-03-23-41-16.a67557c8.png"},854:function(s,t,a){"use strict";a.r(t);var n=a(68),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"一、可执行文件生成概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、可执行文件生成概述"}},[s._v("#")]),s._v(" 一、可执行文件生成概述")]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#一、可执行文件生成概述"}},[s._v("一、可执行文件生成概述")]),n("ul",[n("li",[n("a",{attrs:{href:"#_1-1-gcc-处理-c-程序的过程"}},[s._v("1.1 GCC 处理 C 程序的过程")])]),n("li",[n("a",{attrs:{href:"#_1-2-可执行目标文件的生成"}},[s._v("1.2 可执行目标文件的生成")])])])])])]),n("p"),s._v(" "),n("p",[n("img",{attrs:{src:a(829),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"_1-1-gcc-处理-c-程序的过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-gcc-处理-c-程序的过程"}},[s._v("#")]),s._v(" 1.1 GCC 处理 C 程序的过程")]),s._v(" "),n("h3",{attrs:{id:"_1-预处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-预处理"}},[s._v("#")]),s._v(" 1）预处理")]),s._v(" "),n("p",[s._v("C 预处理程序为 cpp（C Preprocessor），主要用于 C 语言编译器对"),n("strong",[s._v("各种预处理命令进行处理")]),s._v("。包括：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("宏定义的展开")]),s._v("：删除"),n("code",[s._v("#define")]),s._v("并展开所定义的宏")]),s._v(" "),n("li",[n("strong",[s._v("条件预编译的选择")]),s._v("：处理如"),n("code",[s._v("#if")]),s._v(","),n("code",[s._v("#ifdef")]),s._v(", "),n("code",[s._v("#endif")]),s._v("等")]),s._v(" "),n("li",[n("strong",[s._v("头文件的包含")]),s._v("：插入头文件到"),n("code",[s._v("#include")]),s._v("处，可以递归方式进行处理")]),s._v(" "),n("li",[n("strong",[s._v("删除注释")])]),s._v(" "),n("li",[n("strong",[s._v("添加行号和文件名标识")]),s._v("，以便编译时编译器产生调试用的行号信息")]),s._v(" "),n("li",[n("strong",[s._v("保留所有"),n("code",[s._v("#pragma")]),s._v("编译指令")]),s._v("（编译器需要用）")])]),s._v(" "),n("p",[n("strong",[s._v("GCC 预处理命令")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("gcc –E")]),s._v(" hello.c –o hello.i")]),s._v(" "),n("li",[n("strong",[s._v("cpp")]),s._v(" hello.c > hello.i")])]),s._v(" "),n("p",[s._v("经过预编译处理后，得到的是预处理文件（如，hello.i) ，它还是一个可读的文本文件，但不包含任何宏定义。")]),s._v(" "),n("h3",{attrs:{id:"_2-编译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译"}},[s._v("#")]),s._v(" 2）编译")]),s._v(" "),n("p",[s._v("编译过程就是将预处理后得到的预处理文件（如 hello.i）进行词法分析、语法分析、语义分析、优化后，生成汇编代码文件。")]),s._v(" "),n("p",[s._v("用来进行编译处理的程序称为编译程序（"),n("strong",[s._v("编译器")]),s._v("，Compiler）。")]),s._v(" "),n("p",[n("strong",[s._v("GCC 编译命令")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("gcc –S")]),s._v(" hello.i –o hello.s")]),s._v(" "),n("li",[n("strong",[s._v("gcc –S")]),s._v(" hello.c –o hello.s")]),s._v(" "),n("li",[n("strong",[s._v("cc1")]),s._v(" hello.c")])]),s._v(" "),n("p",[s._v("经过编译后，得到的汇编代码文件（如 hello.s）还是可读的文本文件，CPU 无法理解和执行它。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("gcc命令实际上是具体程序（如ccp、cc1、as等）的包装命令，用户通过 gcc 命令来使用具体的预处理程序 ccp、编译程序 cc1 和\n汇编程序 as 等")])]),s._v(" "),n("h3",{attrs:{id:"_3-汇编"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-汇编"}},[s._v("#")]),s._v(" 3）汇编")]),s._v(" "),n("p",[s._v("汇编的功能是将编译生成的汇编语言代码转换成机器指令序列。")]),s._v(" "),n("p",[n("strong",[s._v("GCC 汇编命令")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("gcc –c")]),s._v(" hello.s –o hello.o")]),s._v(" "),n("li",[n("strong",[s._v("gcc –c")]),s._v(" hello.c –o hello.o")]),s._v(" "),n("li",[n("strong",[s._v("as")]),s._v(" hello.s -o hello.o （as是一个汇编程序）")])]),s._v(" "),n("p",[s._v("汇编结果是一个可重定位目标文件（如，hello.o），其中包含的是不可读的二进制代码。")]),s._v(" "),n("h3",{attrs:{id:"_4-链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-链接"}},[s._v("#")]),s._v(" 4）链接")]),s._v(" "),n("p",[s._v("预处理、编译和汇编三个阶段针对一个模块（一个*.c文件）进行处理，得到对应的一个可重定位目标文件（一个*.o文件）。")]),s._v(" "),n("p",[s._v("链接过程将多个可重定位目标文件合并以生成可执行目标文件。链接的本质：合并相同的节。")]),s._v(" "),n("p",[n("strong",[s._v("GCC 链接命令")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("gcc –static")]),s._v(" –o myproc main.o test.o")]),s._v(" "),n("li",[n("strong",[s._v("ld –static")]),s._v(" –o myproc main.o test.o")])]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("–static")]),s._v(" 表示静态链接。如果不指定 -o 选项，则默认生成的可执行文件名为“a.out”。")])]),s._v(" "),n("p",[n("strong",[s._v("链接的好处")]),s._v("：")]),s._v(" "),n("ul",[n("li",[s._v("1：模块化\n"),n("ul",[n("li",[s._v("（1）一个程序可以分成很多源程序文件")]),s._v(" "),n("li",[s._v("（2）可构建公共函数库，如数学库，标准C库等")])])]),s._v(" "),n("li",[s._v("2：效率高\n"),n("ul",[n("li",[s._v("（1）时间上，可分开编译：只需重新编译被修改的源程序文件，然后重新链接；")]),s._v(" "),n("li",[s._v("（2）空间上，无需包含共享库所有代码：源文件中无需包含共享库函数的源码，只要直接调用即可（如，只要直接调用printf()函数，无需包含其源码）。")])])])]),s._v(" "),n("h2",{attrs:{id:"_1-2-可执行目标文件的生成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-可执行目标文件的生成"}},[s._v("#")]),s._v(" 1.2 可执行目标文件的生成")]),s._v(" "),n("p",[s._v("示例：")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// main.c")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("swap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("swap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// swap.c")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extern")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("bufp0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("bufp1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("swap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    bufp1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("buf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    temp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("bufp0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("bufp0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("bufp1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("bufp1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" temp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("ul",[n("li",[s._v("每个模块有自己的代码、数据（初始化全局变量、未初始化全局变量，静态变量、局部变量）；")]),s._v(" "),n("li",[s._v("局部变量temp分配在栈中，不会在过程外被引用，因此不是符号定义。")])]),s._v(" "),n("p",[s._v("使用GCC编译器编译并链接生成可执行程序 P：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("$ gcc -O2 -g -o p main.c swap.c\n$ ./p\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("gcc 编译器的静态链接过程：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(830),alt:""}})]),s._v(" "),n("p",[s._v("链接操作的步骤：")]),s._v(" "),n("ol",[n("li",[s._v("符号解析")]),s._v(" "),n("li",[s._v("合并相关 .o 文件")]),s._v(" "),n("li",[s._v("确定每个符号的地址")]),s._v(" "),n("li",[s._v("在指令中填入新地址")])])])}),[],!1,null,null,null);t.default=r.exports}}]);